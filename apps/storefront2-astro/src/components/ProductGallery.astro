---
import { css } from "../../styled-system/css";
import type { Product } from "../data/products";
import ProductImage from "./ProductImage.astro";

interface Props {
  product: Product;
}

const { product } = Astro.props;

const galleryStyle = css({
  position: "static",
  lg: { position: "sticky", top: "7rem" },
});

const thumbsStyle = css({
  display: "flex",
  gap: "0.5rem",
  md: { gap: "0.8rem" },
});

const thumbStyle = css({
  width: "60px",
  height: "75px",
  position: "relative",
  overflow: "hidden",
  border: "2px solid token(colors.sand)",
  cursor: "pointer",
  transition: "border-color 0.3s",
  display: "flex",
  alignItems: "center",
  justifyContent: "center",
  "&.active, &:hover": { borderColor: "gold" },
  "& svg": { width: "50%", height: "auto" },
  md: { width: "80px", height: "100px" },
});

const thumbBackgrounds = [
  product.gradient,
  "linear-gradient(145deg, #E8DFD0 0%, #F4EDE3 100%)",
  "linear-gradient(145deg, #D4B896 0%, #E8DFD0 100%)",
];
---

<div class={galleryStyle} id="pdpGallery">
  <ProductImage gradient={product.gradient} svg={product.svg} badge={product.badge} variant="gallery" />
  <div class={thumbsStyle}>
    {thumbBackgrounds.map((bg, i) => (
      <div
        class={`${thumbStyle} pdp-thumb ${i === 0 ? "active" : ""}`}
        style={`background:${bg}`}
        data-bg={bg}
        set:html={product.svg}
      />
    ))}
  </div>
</div>

<script>
  document.querySelectorAll(".pdp-thumb").forEach((th) => {
    th.addEventListener("click", () => {
      document
        .querySelectorAll(".pdp-thumb")
        .forEach((t) => t.classList.remove("active"));
      th.classList.add("active");
      const bg = th.getAttribute("data-bg");
      const mainBg = document.querySelector("#pdpGallery .product-bg") as HTMLElement | null;
      if (mainBg && bg) mainBg.style.background = bg;
    });
  });
</script>
