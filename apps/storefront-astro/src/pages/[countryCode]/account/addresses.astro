---
export const prerender = false

import AccountLayout from "@/layouts/AccountLayout.astro"
import AddressBook from "@/components/account/AddressBook"
import { retrieveCustomer } from "@/lib/data/customer"
import { getRegion } from "@/lib/data/regions"

const { countryCode } = Astro.params

if (!countryCode) {
  return Astro.redirect("/us")
}

const customer = await retrieveCustomer()

if (!customer) {
  return Astro.redirect(`/${countryCode}/account`)
}

const region = await getRegion(countryCode)

if (!region) {
  return Astro.redirect(`/${countryCode}/account`)
}
---

<AccountLayout title="Addresses | Medusa Store" countryCode={countryCode}>
  <AddressBook client:load customer={customer} region={region} />
</AccountLayout>
