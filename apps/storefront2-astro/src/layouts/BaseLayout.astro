---
import "../styles/index.css";
import GrainOverlay from "../components/GrainOverlay.astro";
import CustomCursor from "../components/CustomCursor.astro";
import Navbar from "../components/Navbar.astro";
import Footer from "../components/Footer.astro";
import Toast from "../components/Toast.astro";

interface Props {
  title: string;
  navVariant?: "default" | "light";
  activeLink?: string;
}

const { title, navVariant = "default", activeLink } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Rafia â€” Artisanal raphia bags handcrafted in Madagascar. Sustainable luxury where tradition meets contemporary elegance." />
    <title>{title}</title>
    <link rel="preload" href="/fonts/outfit-latin.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preload" href="/fonts/cormorant-garamond-latin-normal.woff2" as="font" type="font/woff2" crossorigin />
  </head>
  <body>
    <GrainOverlay />
    <CustomCursor />
    <Navbar variant={navVariant} activeLink={activeLink} />
    <slot />
    <Footer />
    <Toast />

    <script>
      function initReveal() {
        const obs = new IntersectionObserver(
          (entries) => {
            entries.forEach((e) => {
              if (e.isIntersecting) e.target.classList.add("visible");
            });
          },
          { threshold: 0.15, rootMargin: "0px 0px -50px 0px" }
        );
        document.querySelectorAll(".reveal").forEach((el) => obs.observe(el));
      }

      function initCartBadge() {
        try {
          const items = JSON.parse(localStorage.getItem("rafia_cart") || "[]");
          const count = items.reduce((s: number, i: any) => s + i.qty, 0);
          document.querySelectorAll<HTMLElement>(".cart-count").forEach((el) => {
            el.textContent = String(count);
            el.style.display = count > 0 ? "flex" : "none";
          });
        } catch {}
      }

      document.addEventListener("DOMContentLoaded", () => {
        initReveal();
        initCartBadge();
      });
      document.addEventListener("astro:after-swap", () => {
        initReveal();
        initCartBadge();
      });
    </script>
  </body>
</html>
