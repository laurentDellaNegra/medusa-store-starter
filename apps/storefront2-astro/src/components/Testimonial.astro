---
interface TestimonialItem {
  text: string;
  author: string;
}

interface Props {
  testimonials: TestimonialItem[];
}

const { testimonials } = Astro.props;
---

<section class="testimonial-section">
  <div class="testimonial-inner reveal">
    <div class="testimonial-quote">&ldquo;</div>
    <p class="testimonial-text" id="tText">{testimonials[0].text}</p>
    <p class="testimonial-author" id="tAuth">{testimonials[0].author}</p>
    <div class="testimonial-dots">
      {testimonials.map((_, i) => (
        <button class={`dot ${i === 0 ? "active" : ""}`} data-index={i} aria-label={`Testimonial ${i + 1}`}></button>
      ))}
    </div>
  </div>
</section>

<script define:vars={{ testimonials }}>
  const dots = document.querySelectorAll(".dot");
  const tT = document.getElementById("tText");
  const tA = document.getElementById("tAuth");
  let cur = 0;

  function switchTestimonial(i) {
    if (!tT || !tA) return;
    tT.style.opacity = "0";
    tA.style.opacity = "0";
    setTimeout(() => {
      tT.textContent = testimonials[i].text;
      tA.textContent = testimonials[i].author;
      tT.style.opacity = "1";
      tA.style.opacity = "1";
      dots.forEach((d) => d.classList.remove("active"));
      dots[i]?.classList.add("active");
      cur = i;
    }, 400);
  }

  dots.forEach((d) =>
    d.addEventListener("click", () =>
      switchTestimonial(Number(d.getAttribute("data-index")))
    )
  );

  setInterval(
    () => switchTestimonial((cur + 1) % testimonials.length),
    6000
  );
</script>

<style>
  .testimonial-section {
    padding: 8rem 4rem;
    background: var(--color-espresso);
    color: var(--color-sand-light);
    position: relative;
    overflow: hidden;
  }

  .testimonial-section::before {
    content: "";
    position: absolute;
    top: -200px;
    right: -200px;
    width: 600px;
    height: 600px;
    border-radius: var(--radius-full);
    background: radial-gradient(circle, rgba(184, 149, 106, 0.08) 0%, transparent 70%);
  }

  .testimonial-inner {
    max-width: var(--size-content-xl);
    margin-inline: auto;
    text-align: center;
    position: relative;
  }

  .testimonial-quote {
    font-family: var(--font-display);
    font-size: var(--fs-display);
    color: var(--color-gold);
    line-height: 0.5;
    margin-bottom: 2rem;
    opacity: 0.5;
  }

  .testimonial-text {
    font-family: var(--font-display);
    font-size: clamp(1.5rem, 2.5vw, 2.2rem);
    font-weight: var(--fw-light);
    font-style: italic;
    line-height: var(--lh-normal);
    margin-bottom: 2.5rem;
    color: var(--color-sand);
    transition: opacity 0.4s ease;
  }

  .testimonial-author {
    font-size: var(--fs-caption);
    letter-spacing: var(--ls-editorial);
    text-transform: uppercase;
    color: var(--color-gold);
    transition: opacity 0.4s ease;
  }

  .testimonial-dots {
    display: flex;
    gap: 0.8rem;
    justify-content: center;
    margin-top: 3rem;
  }

  .dot {
    width: 8px;
    height: 8px;
    border-radius: var(--radius-full);
    border: 1px solid var(--color-gold);
    cursor: pointer;
    transition: all 0.3s;
    background: transparent;
    padding: 0;
  }

  .dot:global(.active) {
    background: var(--color-gold);
    transform: scale(1.2);
  }
</style>
