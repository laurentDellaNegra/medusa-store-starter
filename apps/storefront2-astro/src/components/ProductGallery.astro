---
import type { Product } from "../data/products";
import ProductImage from "./ProductImage.astro";

interface Props {
  product: Product;
}

const { product } = Astro.props;

const thumbBackgrounds = [
  product.gradient,
  "linear-gradient(145deg, #E8DFD0 0%, #F4EDE3 100%)",
  "linear-gradient(145deg, #D4B896 0%, #E8DFD0 100%)",
];
---

<div class="gallery" id="pdpGallery">
  <ProductImage gradient={product.gradient} svg={product.svg} badge={product.badge} variant="gallery" />
  <div class="gallery__thumbs">
    {thumbBackgrounds.map((bg, i) => (
      <div
        class={`gallery__thumb pdp-thumb ${i === 0 ? "active" : ""}`}
        style={`background:${bg}`}
        data-bg={bg}
        set:html={product.svg}
      />
    ))}
  </div>
</div>

<script>
  document.querySelectorAll(".pdp-thumb").forEach((th) => {
    th.addEventListener("click", () => {
      document
        .querySelectorAll(".pdp-thumb")
        .forEach((t) => t.classList.remove("active"));
      th.classList.add("active");
      const bg = th.getAttribute("data-bg");
      const mainBg = document.querySelector("#pdpGallery .product-bg") as HTMLElement | null;
      if (mainBg && bg) mainBg.style.background = bg;
    });
  });
</script>

<style>
  .gallery {
    position: static;
  }

  @media (min-width: 1024px) {
    .gallery {
      position: sticky;
      top: 7rem;
    }
  }

  .gallery__thumbs {
    display: flex;
    gap: 0.5rem;
  }

  @media (min-width: 768px) {
    .gallery__thumbs {
      gap: 0.8rem;
    }
  }

  .gallery__thumb {
    width: 60px;
    height: 75px;
    position: relative;
    overflow: hidden;
    border: 2px solid var(--color-sand);
    cursor: pointer;
    transition: border-color 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .gallery__thumb:global(.active),
  .gallery__thumb:hover {
    border-color: var(--color-gold);
  }

  .gallery__thumb :global(svg) {
    width: 50%;
    height: auto;
  }

  @media (min-width: 768px) {
    .gallery__thumb {
      width: 80px;
      height: 100px;
    }
  }
</style>
