<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shopping Bag — Rafia</title>
<link rel="stylesheet" href="shared.css">
<style>
  .cart-page { padding: 9rem 4rem 4rem; max-width: 1200px; margin: 0 auto; min-height: 60vh; }
  .cart-header {
    display: flex; justify-content: space-between; align-items: baseline;
    margin-bottom: 3rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--sand);
  }
  .cart-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(2rem, 3.5vw, 3rem); font-weight: 300;
  }
  .cart-title em { font-style: italic; color: var(--gold); }
  .cart-item-count { font-size: 0.75rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--espresso-soft); }

  .cart-layout { display: grid; grid-template-columns: 1fr 380px; gap: 4rem; align-items: start; }

  /* Cart items */
  .cart-items { display: flex; flex-direction: column; }
  .cart-item {
    display: grid; grid-template-columns: 120px 1fr auto; gap: 2rem;
    padding: 2rem 0; border-bottom: 1px solid var(--sand); align-items: center;
    animation: fadeInItem 0.5s ease forwards; opacity: 0;
  }
  .cart-item:nth-child(1) { animation-delay: 0.05s; }
  .cart-item:nth-child(2) { animation-delay: 0.1s; }
  .cart-item:nth-child(3) { animation-delay: 0.15s; }
  .cart-item:nth-child(4) { animation-delay: 0.2s; }
  @keyframes fadeInItem { to { opacity: 1; } }

  .cart-item-image {
    aspect-ratio: 3/4; position: relative; overflow: hidden;
    display: flex; align-items: center; justify-content: center;
  }
  .cart-item-bg { position: absolute; inset: 0; }
  .cart-item-image svg { width: 55%; height: auto; position: relative; z-index: 1; filter: drop-shadow(0 5px 15px rgba(44,24,16,0.12)); }

  .cart-item-details { display: flex; flex-direction: column; gap: 0.4rem; }
  .ci-name {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.3rem; font-weight: 400;
  }
  .ci-name a { color: var(--espresso); text-decoration: none; transition: color 0.3s; }
  .ci-name a:hover { color: var(--gold); }
  .ci-type { font-size: 0.7rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--espresso-soft); }
  .ci-price { font-family: 'Cormorant Garamond', serif; font-size: 1.1rem; color: var(--gold); margin-top: 0.3rem; }
  .ci-actions { display: flex; align-items: center; gap: 1.5rem; margin-top: 0.8rem; }
  .ci-qty {
    display: flex; align-items: center; border: 1px solid var(--sand);
  }
  .ci-qty-btn {
    width: 34px; height: 34px; border: none; background: transparent;
    font-size: 0.95rem; color: var(--espresso); cursor: pointer;
    font-family: 'Outfit', sans-serif; transition: background 0.3s;
  }
  .ci-qty-btn:hover { background: var(--sand-pale); }
  .ci-qty-val {
    width: 38px; text-align: center; border: none;
    border-left: 1px solid var(--sand); border-right: 1px solid var(--sand);
    font-family: 'Outfit', sans-serif; font-size: 0.8rem;
    height: 34px; background: transparent; color: var(--espresso); outline: none;
  }
  .ci-remove {
    font-size: 0.65rem; letter-spacing: 0.15em; text-transform: uppercase;
    color: var(--espresso-soft); background: none; border: none;
    cursor: pointer; text-decoration: underline; text-underline-offset: 3px;
    font-family: 'Outfit', sans-serif; transition: color 0.3s;
  }
  .ci-remove:hover { color: var(--terracotta); }

  .cart-item-total {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.3rem; color: var(--espresso); text-align: right; white-space: nowrap;
  }

  /* Summary */
  .cart-summary {
    background: var(--sand-pale); padding: 2.5rem;
    position: sticky; top: 7rem;
  }
  .cs-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem; font-weight: 400; margin-bottom: 2rem;
    padding-bottom: 1.2rem; border-bottom: 1px solid var(--sand);
  }
  .cs-row {
    display: flex; justify-content: space-between; align-items: center;
    padding: 0.7rem 0;
  }
  .cs-label { font-size: 0.8rem; letter-spacing: 0.08em; color: var(--espresso-soft); }
  .cs-value { font-size: 0.9rem; color: var(--espresso); }
  .cs-divider { height: 1px; background: var(--sand); margin: 1rem 0; }
  .cs-total-row {
    display: flex; justify-content: space-between; align-items: baseline;
    padding: 1rem 0 0;
  }
  .cs-total-label {
    font-size: 0.7rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--espresso);
  }
  .cs-total-value {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.8rem; color: var(--espresso);
  }

  .cs-checkout-btn {
    width: 100%; padding: 1.1rem; margin-top: 2rem;
    background: var(--espresso); color: var(--sand-light);
    font-family: 'Outfit', sans-serif; font-size: 0.75rem;
    letter-spacing: 0.25em; text-transform: uppercase; border: none;
    cursor: pointer; position: relative; overflow: hidden; transition: all 0.5s;
  }
  .cs-checkout-btn::before {
    content: ''; position: absolute; top: 0; left: -100%;
    width: 100%; height: 100%; background: var(--gold);
    transition: left 0.5s ease; z-index: 0;
  }
  .cs-checkout-btn:hover::before { left: 0; }
  .cs-checkout-btn span { position: relative; z-index: 1; }

  .cs-continue {
    display: block; text-align: center; margin-top: 1.2rem;
    font-size: 0.7rem; letter-spacing: 0.15em; text-transform: uppercase;
    color: var(--gold); text-decoration: none; transition: color 0.3s;
  }
  .cs-continue:hover { color: var(--espresso); }

  .cs-features {
    margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--sand);
    display: flex; flex-direction: column; gap: 0.8rem;
  }
  .cs-feature {
    display: flex; align-items: center; gap: 0.8rem;
    font-size: 0.72rem; letter-spacing: 0.08em; color: var(--espresso-soft);
  }
  .cs-feature svg { width: 16px; height: 16px; color: var(--gold); flex-shrink: 0; }

  /* Promo code */
  .cs-promo { margin-top: 1.5rem; }
  .cs-promo-toggle {
    font-size: 0.7rem; letter-spacing: 0.12em; text-transform: uppercase;
    color: var(--gold); background: none; border: none; cursor: pointer;
    font-family: 'Outfit', sans-serif; text-decoration: underline; text-underline-offset: 3px;
  }
  .cs-promo-form {
    display: none; margin-top: 0.8rem;
    flex-direction: row; gap: 0;
  }
  .cs-promo-form.open { display: flex; }
  .cs-promo-input {
    flex: 1; padding: 0.7rem 1rem; border: 1px solid var(--sand); border-right: none;
    background: white; font-family: 'Outfit', sans-serif; font-size: 0.8rem;
    color: var(--espresso); outline: none;
  }
  .cs-promo-input::placeholder { color: var(--gold-light); }
  .cs-promo-apply {
    padding: 0.7rem 1.2rem; background: var(--espresso); color: var(--sand-light);
    font-family: 'Outfit', sans-serif; font-size: 0.65rem; letter-spacing: 0.15em;
    text-transform: uppercase; border: 1px solid var(--espresso); cursor: pointer; transition: all 0.3s;
  }
  .cs-promo-apply:hover { background: var(--gold); border-color: var(--gold); }

  /* Empty cart */
  .cart-empty {
    text-align: center; padding: 6rem 2rem; grid-column: 1 / -1;
  }
  .cart-empty-icon { margin-bottom: 2rem; color: var(--sand); }
  .cart-empty-icon svg { width: 64px; height: 64px; }
  .cart-empty-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2rem; font-weight: 300; margin-bottom: 1rem;
  }
  .cart-empty-desc { font-size: 0.9rem; color: var(--espresso-soft); margin-bottom: 2.5rem; line-height: 1.7; }

  @media (max-width: 1024px) {
    .cart-layout { grid-template-columns: 1fr; }
    .cart-summary { position: static; }
  }
  @media (max-width: 768px) {
    .cart-page { padding: 7rem 1.5rem 3rem; }
    .cart-item { grid-template-columns: 90px 1fr; gap: 1.2rem; }
    .cart-item-total { grid-column: 2; text-align: left; margin-top: -0.5rem; }
    .cart-header { flex-direction: column; gap: 0.5rem; }
  }
</style>
</head>
<body>
<div class="grain"></div>
<div class="cursor-dot" id="cursorDot"></div>
<div class="cursor-ring" id="cursorRing"></div>

<nav id="navbar" class="nav-light">
  <a href="index.html" class="logo">Rafia<span>.</span></a>
  <ul class="nav-center">
    <li><a href="shop.html">Collection</a></li>
    <li><a href="index.html#story">Our Story</a></li>
    <li><a href="index.html#values">Savoir-Faire</a></li>
    <li><a href="index.html#contact">Contact</a></li>
  </ul>
  <div class="nav-right">
    <a href="cart.html" class="cart-icon" title="Shopping Bag" style="color:var(--gold)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
      <span class="cart-count" style="display:none;">0</span>
    </a>
    <div class="menu-toggle" id="menuToggle"><span></span><span></span><span></span></div>
  </div>
</nav>

<section class="cart-page">
  <div class="cart-header">
    <h1 class="cart-title">Your <em>Bag</em></h1>
    <span class="cart-item-count" id="cartItemCount"></span>
  </div>
  <div class="cart-layout" id="cartLayout"></div>
</section>

<footer>
  <div class="footer-top">
    <div class="footer-brand"><a href="index.html" class="logo">Rafia<span>.</span></a><p class="footer-desc">Artisanal raphia bags, handcrafted in Madagascar.</p></div>
    <div><p class="footer-heading">Shop</p><ul class="footer-links"><li><a href="shop.html">All Bags</a></li><li><a href="shop.html">Totes</a></li><li><a href="shop.html">Clutches</a></li></ul></div>
    <div><p class="footer-heading">About</p><ul class="footer-links"><li><a href="index.html#story">Our Story</a></li><li><a href="#">Artisans</a></li><li><a href="#">Sustainability</a></li></ul></div>
    <div><p class="footer-heading">Help</p><ul class="footer-links"><li><a href="#">Shipping</a></li><li><a href="#">Returns</a></li><li><a href="#">Care Guide</a></li></ul></div>
  </div>
  <div class="footer-bottom"><span>&copy; 2025 Rafia. All rights reserved.</span><div class="footer-social"><a href="#">Instagram</a><a href="#">Pinterest</a><a href="#">Facebook</a></div></div>
</footer>

<script src="products.js"></script>
<script src="shared.js"></script>
<script>
  function renderCart() {
    const items = RafiaCart.items;
    const layout = document.getElementById('cartLayout');
    const countEl = document.getElementById('cartItemCount');

    if (items.length === 0) {
      countEl.textContent = '0 items';
      layout.innerHTML = `
        <div class="cart-empty">
          <div class="cart-empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg></div>
          <h2 class="cart-empty-title">Your bag is empty</h2>
          <p class="cart-empty-desc">Looks like you haven't added any pieces to your bag yet.<br>Explore our collection and find your perfect companion.</p>
          <a href="shop.html" class="btn-primary"><span>Browse Collection</span></a>
        </div>`;
      return;
    }

    const totalItems = items.reduce((s, i) => s + i.qty, 0);
    countEl.textContent = totalItems + ' item' + (totalItems !== 1 ? 's' : '');

    const subtotal = items.reduce((s, i) => s + i.price * i.qty, 0);
    const shipping = subtotal >= 150 ? 0 : 12;
    const total = subtotal + shipping;

    let itemsHtml = '<div class="cart-items">';
    items.forEach(item => {
      itemsHtml += `
        <div class="cart-item" data-id="${item.id}">
          <a href="product.html?id=${item.id}" class="cart-item-image">
            <div class="cart-item-bg" style="background:${item.gradient || 'var(--sand)'}"></div>
            ${item.svg || ''}
          </a>
          <div class="cart-item-details">
            <h3 class="ci-name"><a href="product.html?id=${item.id}">${item.name}</a></h3>
            <p class="ci-type">${item.type || ''} ${item.color ? '— ' + item.color : ''}</p>
            <p class="ci-price">CHF ${item.price}</p>
            <div class="ci-actions">
              <div class="ci-qty">
                <button class="ci-qty-btn" data-action="minus" data-id="${item.id}">&minus;</button>
                <input type="text" class="ci-qty-val" value="${item.qty}" readonly>
                <button class="ci-qty-btn" data-action="plus" data-id="${item.id}">+</button>
              </div>
              <button class="ci-remove" data-id="${item.id}">Remove</button>
            </div>
          </div>
          <div class="cart-item-total">CHF ${item.price * item.qty}</div>
        </div>`;
    });
    itemsHtml += '</div>';

    const summaryHtml = `
      <div class="cart-summary">
        <h2 class="cs-title">Order Summary</h2>
        <div class="cs-row"><span class="cs-label">Subtotal</span><span class="cs-value">CHF ${subtotal}</span></div>
        <div class="cs-row"><span class="cs-label">Shipping</span><span class="cs-value">${shipping === 0 ? 'Complimentary' : 'CHF ' + shipping}</span></div>
        <div class="cs-promo">
          <button class="cs-promo-toggle" id="promoToggle">Add promo code</button>
          <div class="cs-promo-form" id="promoForm">
            <input type="text" class="cs-promo-input" placeholder="Enter code">
            <button class="cs-promo-apply">Apply</button>
          </div>
        </div>
        <div class="cs-divider"></div>
        <div class="cs-total-row">
          <span class="cs-total-label">Total</span>
          <span class="cs-total-value">CHF ${total}</span>
        </div>
        <button class="cs-checkout-btn"><span>Proceed to Checkout</span></button>
        <a href="shop.html" class="cs-continue">Continue Shopping</a>
        <div class="cs-features">
          <div class="cs-feature">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>
            Free shipping over CHF 150
          </div>
          <div class="cs-feature">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/></svg>
            14-day returns
          </div>
          <div class="cs-feature">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
            Secure checkout
          </div>
        </div>
      </div>`;

    layout.innerHTML = itemsHtml + summaryHtml;

    // Bind events
    layout.querySelectorAll('.ci-qty-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.id;
        const action = btn.dataset.action;
        const item = RafiaCart.items.find(i => i.id === id);
        if (!item) return;
        if (action === 'plus') { RafiaCart.updateQty(id, item.qty + 1); }
        else if (action === 'minus') {
          if (item.qty <= 1) { RafiaCart.remove(id); }
          else { RafiaCart.updateQty(id, item.qty - 1); }
        }
        RafiaCart.updateBadge();
        renderCart();
      });
    });

    layout.querySelectorAll('.ci-remove').forEach(btn => {
      btn.addEventListener('click', () => {
        const el = btn.closest('.cart-item');
        el.style.transition = 'opacity 0.4s, transform 0.4s';
        el.style.opacity = '0';
        el.style.transform = 'translateX(-30px)';
        setTimeout(() => {
          RafiaCart.remove(btn.dataset.id);
          RafiaCart.updateBadge();
          renderCart();
        }, 400);
      });
    });

    // Promo toggle
    const pt = document.getElementById('promoToggle');
    const pf = document.getElementById('promoForm');
    if (pt && pf) {
      pt.addEventListener('click', () => { pf.classList.toggle('open'); });
    }

    // Checkout button
    layout.querySelector('.cs-checkout-btn').addEventListener('click', () => {
      const btn = layout.querySelector('.cs-checkout-btn span');
      btn.textContent = 'Processing...';
      setTimeout(() => {
        btn.textContent = 'Thank you!';
        setTimeout(() => {
          RafiaCart.clear();
          renderCart();
        }, 1500);
      }, 1500);
    });
  }

  renderCart();
</script>
</body>
</html>
