---
export const prerender = false

import MainLayout from "@/layouts/MainLayout.astro"
import CartTemplate from "@/components/cart/CartTemplate.astro"
import EmptyCart from "@/components/cart/EmptyCart.astro"
import { retrieveCart } from "@/lib/data/cart"
import { retrieveCustomer } from "@/lib/data/customer"

const { countryCode } = Astro.params

if (!countryCode) {
  return Astro.redirect("/us")
}

const [cart, customer] = await Promise.all([
  retrieveCart(),
  retrieveCustomer(),
])
---

<MainLayout title="Cart | Medusa Store" countryCode={countryCode}>
  {(!cart || !cart.items?.length) ? (
    <EmptyCart countryCode={countryCode} />
  ) : (
    <CartTemplate cart={cart} customer={customer} countryCode={countryCode} />
  )}
</MainLayout>
