---
import BaseLayout from "./BaseLayout.astro"
import { retrieveCart } from "@/lib/data/cart"
import { css } from "styled-system/css"

interface Props {
  title?: string
  countryCode: string
}

const { title, countryCode } = Astro.props
const cart = await retrieveCart()
---

<BaseLayout title={title}>
  <script is:inline type="application/json" id="cart-init-data" set:html={JSON.stringify(cart)} />
  <script>
    import { setCart } from '@/stores/cart'
    const el = document.getElementById('cart-init-data')
    if (el) {
      try {
        const cart = JSON.parse(el.textContent || '{}')
        if (cart && cart.id) setCart(cart)
      } catch {}
    }
  </script>
  <div class={css({
    borderBottomWidth: "1px",
    borderColor: "border.default",
    bg: "bg.default",
  })}>
    <nav class={css({
      maxW: "8xl",
      mx: "auto",
      px: { base: "4", md: "8" },
      h: "16",
      display: "flex",
      alignItems: "center",
      justifyContent: "space-between",
    })}>
      <a
        href={`/${countryCode}/cart`}
        class={css({
          fontSize: "sm",
          color: "fg.muted",
          textDecoration: "none",
          _hover: { color: "fg.default" },
        })}
      >
        &larr; Back to cart
      </a>
      <a
        href={`/${countryCode}`}
        class={css({
          fontWeight: "bold",
          fontSize: "lg",
          textTransform: "uppercase",
          letterSpacing: "wider",
          color: "fg.default",
          textDecoration: "none",
        })}
      >
        Medusa Store
      </a>
      <div class={css({ w: "24" })} />
    </nav>
  </div>
  <main>
    <slot />
  </main>
</BaseLayout>
